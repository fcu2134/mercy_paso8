@model MercDevs_ej2.Models.Datosfichatecnica

@if (Model == null)
{
    <p>Modelo no disponible.</p>
}
else
{
   
    

   
        <h1>Datos Ficha Técnica</h1>
    <div id="pdfContent">
        <table class="table table-dark table-striped border border-light-subtle border-3">
            <thead style="text-align:center">
                <tr>
                    <th colspan="3">Datos Ficha Técnica</th>
                </tr>
                <tr>
                    <th class="border-end">ID Ficha: @Model.IdDatosFichaTecnica</th>
                    <th class="border-end">Fecha Inicio: @(Model.FechaInicio?.ToString("dd/MM/yyyy") ?? "No disponible")</th>
                    <th class="border-end">Fecha Finalización: @(Model.FechaFinalizacion?.ToString("dd/MM/yyyy") ?? "No disponible")</th>
                </tr>
            </thead>
        </table>

        <table class="table table-dark table-striped border border-light-subtle border-3">
            <thead style="text-align:center">
                <tr>
                    <th colspan="3">Datos del Cliente</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th class="border-end">Nombre: @(Model.RecepcionEquipo?.IdClienteNavigation?.Nombre ?? "No disponible")</th>
                    <th class="border-end">Apellido: @(Model.RecepcionEquipo?.IdClienteNavigation?.Apellido ?? "No disponible")</th>
                    <th class="border-end">Celular: @(Model.RecepcionEquipo?.IdClienteNavigation?.Telefono ?? "No disponible")</th>
                </tr>
                <tr>
                    <td colspan="2" class="border-end">Correo: @(Model.RecepcionEquipo?.IdClienteNavigation?.Correo ?? "No disponible")</td>
                    <td colspan="2" class="border-end">Dirección: @(Model.RecepcionEquipo?.IdClienteNavigation?.Direccion ?? "No disponible")</td>
                </tr>
            </tbody>
        </table>

        <table class="table table-dark table-striped border border-light-subtle border-3">
            <thead style="text-align:center">
                <tr>
                    <th colspan="3">Datos Recepción de Equipo</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th class="border-end">Fecha: @(Model.RecepcionEquipo?.Fecha?.ToString("dd/MM/yyyy") ?? "No disponible")</th>
                    <th class="border-end">
                        Tipo PC: @{
                            string tipopc = "";
                            switch (Model.RecepcionEquipo?.TipoPc)
                            {
                                case 0:
                                    tipopc = "PC Torre";
                                    break;
                                case 1:
                                    tipopc = "Notebook";
                                    break;
                                case 2:
                                    tipopc = "All in one";
                                    break;
                                default:
                                    tipopc = "No disponible";
                                    break;
                            }
                            @tipopc
                        }
                    </th>
                    <th class="border-end">Accesorios: @(Model.RecepcionEquipo?.Accesorio ?? "No disponible")</th>
                </tr>
                <tr>
                    <th class="border-end">Marca PC: @(Model.RecepcionEquipo?.MarcaPc ?? "No disponible")</th>
                    <th class="border-end">Modelo PC: @(Model.RecepcionEquipo?.ModeloPc ?? "No disponible")</th>
                    <th class="border-end">Número Serie: @(Model.RecepcionEquipo?.Nserie ?? "No disponible")</th>
                </tr>
                <tr>
                    <th class="border-end">
                        Capacidad RAM: @{
                            string capacidadram = "";
                            switch (Model.RecepcionEquipo?.CapacidadRam)
                            {
                                case 0:
                                    capacidadram = "4 GB";
                                    break;
                                case 1:
                                    capacidadram = "6 GB";
                                    break;
                                case 2:
                                    capacidadram = "8 GB";
                                    break;
                                case 3:
                                    capacidadram = "12 GB";
                                    break;
                                case 4:
                                    capacidadram = "OTRA";
                                    break;
                                default:
                                    capacidadram = "No disponible";
                                    break;
                            }
                            @capacidadram
                        }
                    </th>
                    <th class="border-end">
                        Tipo GPU: @{
                            string tipogpu = "";
                            switch (Model.RecepcionEquipo?.TipoGpu)
                            {
                                case 0:
                                    tipogpu = "Chip integrado";
                                    break;
                                case 1:
                                    tipogpu = "Tarjeta";
                                    break;
                                default:
                                    tipogpu = "No disponible";
                                    break;
                            }
                            @tipogpu
                        }
                    </th>
                    <th class="border-end">Gráficos: @(Model.RecepcionEquipo?.Grafico ?? "No disponible")</th>
                </tr>
                <tr>
                    <td colspan="2" class="border-end">
                        Tipo Almacenamiento: @{
                            string tipoalmacenamiento = "";
                            switch (Model.RecepcionEquipo?.TipoAlmacenamiento)
                            {
                                case 0:
                                    tipoalmacenamiento = "HDD";
                                    break;
                                case 1:
                                    tipoalmacenamiento = "SSD SATA";
                                    break;
                                case 2:
                                    tipoalmacenamiento = "SSD M.2";
                                    break;
                                case 3:
                                    tipoalmacenamiento = "SSD NVM M.2";
                                    break;
                                default:
                                    tipoalmacenamiento = "No disponible";
                                    break;
                            }
                            @tipoalmacenamiento
                        }
                    </td>
                    <td colspan="2" class="border-end">Capacidad Almacenamiento: @(Model.RecepcionEquipo?.CapacidadAlmacenamiento ?? "No disponible")</td>
                </tr>
            </tbody>
        </table>

        <table class="table table-dark table-striped border border-light-subtle border-3">
            <thead style="text-align:center">
                <tr>
                    <th colspan="3">Datos Ficha Técnica</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th class="border-end">
                        S.O Instalado: @{
                            string soinstalado = "";
                            switch (Model.Soinstalado)
                            {
                                case 0:
                                    soinstalado = "Windows 10";
                                    break;
                                case 1:
                                    soinstalado = "Windows 11";
                                    break;
                                case 2:
                                    soinstalado = "Linux";
                                    break;
                                default:
                                    soinstalado = "No disponible";
                                    break;
                            }
                            @soinstalado
                        }
                    </th>
                    <th class="border-end">
                        Suite Office Instalada: @{
                            string suiteofficeinstalada = "";
                            switch (Model.SuiteOfficeInstalada)
                            {
                                case 0:
                                    suiteofficeinstalada = "Microsoft Office 2013";
                                    break;
                                case 1:
                                    suiteofficeinstalada = "Microsoft Office 2019";
                                    break;
                                case 2:
                                    suiteofficeinstalada = "Microsoft Office 365";
                                    break;
                                case 3:
                                    suiteofficeinstalada = "OpenOffice";
                                    break;
                                default:
                                    suiteofficeinstalada = "No disponible";
                                    break;
                            }
                            @suiteofficeinstalada
                        }
                    </th>
                    <th class="border-end">
                        Lector PDF Instalado: @{
                            string lectorpdfinstalado = "";
                            switch (Model.LectorPdfinstalado)
                            {
                                case 0:
                                    lectorpdfinstalado = "No Instalado";
                                    break;
                                case 1:
                                    lectorpdfinstalado = "Instalado";
                                    break;
                                case 2:
                                    lectorpdfinstalado = "No Aplica";
                                    break;
                                default:
                                    lectorpdfinstalado = "No disponible";
                                    break;
                            }
                            @lectorpdfinstalado
                        }
                    </th>
                </tr>
                <tr>
                    <td colspan="2" class="border-end">
                        Navegador Web Instalado: @{
                            string navegadorwebinstalado = "";
                            switch (Model.NavegadorWebInstalado)
                            {
                                case 0:
                                    navegadorwebinstalado = "No Instalado";
                                    break;
                                case 1:
                                    navegadorwebinstalado = "Chrome";
                                    break;
                                case 2:
                                    navegadorwebinstalado = "Chrome y Firefox";
                                    break;
                                default:
                                    navegadorwebinstalado = "No disponible";
                                    break;
                            }
                            @navegadorwebinstalado
                        }
                    </td>
                    <td colspan="2" class="border-end">
                        Antivirus Instalado: @{
                            string antivirusinstalado = "";
                            switch (Model.AntivirusInstalado)
                            {
                                case "0":
                                    antivirusinstalado = "No Instalado";
                                    break;
                                case "1":
                                    antivirusinstalado = "Avast";
                                    break;
                                case "2":
                                    antivirusinstalado = "McAfee";
                                    break;
                                default:
                                    antivirusinstalado = "No disponible";
                                    break;
                            }
                            @antivirusinstalado
                        }
                    </td>
                </tr>
            </tbody>
        </table>

        <table class="table table-dark table-striped border border-light-subtle border-3">
            <thead style="text-align:center">
                <tr>
                    <th colspan="3">Diagnóstico y Soluciones</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    @if (Model.Diagnosticosolucions == null || !Model.Diagnosticosolucions.Any())
                    {
                        <th class="border-end">No hay diagnóstico disponible</th>
                    }
                    else
                    {
                        @foreach (var diagnostico in Model.Diagnosticosolucions)
                        {
                            <th class="border-end">Diagnóstico: @diagnostico.DescripcionDiagnostico</th>
                        }
                    }
                </tr>
                <tr>
                    @if (Model.Diagnosticosolucions == null || !Model.Diagnosticosolucions.Any())
                    {
                        <th class="border-end">No hay solución disponible</th>
                    }
                    else
                    {
                        @foreach (var diagnostico in Model.Diagnosticosolucions)
                        {
                            <th class="border-end">Solución: @diagnostico.DescripcionSolucion</th>
                        }
                    }
                </tr>
            </tbody>
        </table>

        <table class="table table-dark table-striped border border-light-subtle border-3">
            <thead style="text-align:center">
                <tr>
                    <th colspan="3">Observaciones y Recomendaciones</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="3" class="border-end">@Model.PobservacionesRecomendaciones</td>
                </tr>
            </tbody>
        </table>
    </div>
        <button id="enviarPdf" style="cursor: pointer; padding: 10px 20px; margin-left: 20px; background-color:red">Enviar PDF por Correo</button>
        <img id="descargaarPdf" src="@Url.Content("~/imagenes/descarga.png")" alt="Descargar PDF" style="cursor: pointer; width: 120px; height: auto; padding: 10px 20px;margin-left:45%" />

        <!-- Scripts para html2pdf -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var element = document.getElementById('pdfContent');
                var opt = {
                    margin: 0.5,
                    filename: 'ficha_tecnica.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                };

                html2pdf().set(opt).from(element).toPdf().get('pdf').then(function (pdf) {
                    var totalPages = pdf.internal.getNumberOfPages();
                    if (totalPages > 1) {
                        pdf.deletePage(2);
                    }

                    window.pdfData = pdf.output('datauristring');
                    console.log('PDF Data:', window.pdfData);
                });

                document.getElementById('descargaarPdf').addEventListener('click', function () {
                    if (window.pdfData) {
                        var link = document.createElement('a');
                        link.href = window.pdfData;
                        link.download = 'ficha_tecnica.pdf';
                        link.click();
                    } else {
                        alert('Primero genera el PDF.');
                    }
                });

                document.getElementById('enviarPdf').addEventListener('click', function () {
                    if (window.pdfData) {
                        fetch('/Datosfichatecnicas/EnviarFichaPorCorreo', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ pdfData: window.pdfData.split(',')[1], Id: @Model.IdDatosFichaTecnica })
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    alert('PDF enviado correctamente.');
                                } else {
                                    alert('Error al enviar el PDF: ' + data.message);
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('Error al enviar el PDF.');
                            });
                    } else {
                        alert('Primero genera el PDF.');
                    }
                });
            });
        </script>
    
}
